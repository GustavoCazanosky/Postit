<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Post-it Coloridos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  #login, #app {
    margin-top: 40px;
  }
  input, button {
    padding: 8px;
    margin: 5px;
    font-size: 15px;
  }
  #board {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .note {
    width: 180px;
    height: 180px;
    margin: 10px;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
    position: relative;
  }
  .note textarea {
    width: 100%;
    height: 120px;
    border: none;
    resize: none;
    background: transparent;
    outline: none;
    font-size: 14px;
  }
  .delete-btn {
    position: absolute;
    top: 5px;
    right: 8px;
    border: none;
    background: transparent;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
  }
  .color-picker {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 30px;
    height: 30px;
    border: none;
  }
</style>
</head>
<body>

<h2>Post-it Coloridos</h2>

<div id="login">
  <input type="text" id="name" placeholder="Seu nome"><br>
  <input type="text" id="phone" placeholder="Telefone"><br>
  <button id="btnLogin">Entrar</button>
  <p id="error" style="color:red;"></p>
</div>

<div id="app" style="display:none;">
  <h3>Bem-vindo, <span id="userName"></span>!</h3>
  <button id="btnAdd">‚ûï Nova Nota</button>
  <button id="btnSave">üíæ Salvar</button>
  <button id="btnClear">üóëÔ∏è Apagar Tudo</button>
  <div id="board"></div>
</div>

<script>
  const EXPIRE_DAYS = 5; // dias at√© expirar

  let userKey = null;

  // Login simples
  document.getElementById('btnLogin').onclick = () => {
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const err = document.getElementById('error');
    if (!name || !phone) {
      err.textContent = 'Preencha nome e telefone.';
      return;
    }
    err.textContent = '';
    userKey = `${name}_${phone}`;
    document.getElementById('userName').textContent = name;
    document.getElementById('login').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    loadNotes();
  };

  document.getElementById('btnAdd').onclick = () => createNote('', getRandomColor(), null);
  document.getElementById('btnSave').onclick = () => saveNotes();
  document.getElementById('btnClear').onclick = () => {
    if (confirm('Apagar todas as notas?')) {
      localStorage.removeItem(userKey);
      document.getElementById('board').innerHTML = '';
    }
  };

  // Carregar notas
  function loadNotes() {
    const raw = localStorage.getItem(userKey);
    if (!raw) return;
    try {
      const data = JSON.parse(raw);
      const now = Date.now();
      if (now - data.timestamp > EXPIRE_DAYS * 24 * 60 * 60 * 1000) {
        localStorage.removeItem(userKey);
        return;
      }
      data.notes.forEach(n => createNote(n.content, n.color, n.id));
    } catch(e) {
      console.error('Erro ao carregar notas:', e);
    }
  }

  // Criar nota
  function createNote(content, color, id) {
    const board = document.getElementById('board');
    const note = document.createElement('div');
    note.className = 'note';
    note.style.background = color;
    note.dataset.id = id || crypto.randomUUID();

    const del = document.createElement('button');
    del.className = 'delete-btn';
    del.textContent = '√ó';
    del.onclick = () => note.remove();

    const ta = document.createElement('textarea');
    ta.value = content;

    const colorPick = document.createElement('input');
    colorPick.type = 'color';
    colorPick.className = 'color-picker';
    colorPick.value = rgbToHex(color);
    colorPick.oninput = () => note.style.background = colorPick.value;

    note.appendChild(del);
    note.appendChild(ta);
    note.appendChild(colorPick);
    board.appendChild(note);
  }

  // Salvar notas no localStorage
  function saveNotes() {
    const notesDivs = document.querySelectorAll('.note');
    const notes = Array.from(notesDivs).map(nd => ({
      id: nd.dataset.id,
      content: nd.querySelector('textarea').value,
      color: nd.style.background
    }));
    const data = { notes, timestamp: Date.now() };
    localStorage.setItem(userKey, JSON.stringify(data));
    alert('Notas salvas!');
  }

  function getRandomColor() {
    const colors = ['#fffa8b', '#ffb3b3', '#c3ffad', '#aad8ff', '#ffd4a3'];
    return colors[Math.floor(Math.random() * colors.length)];
  }

  function rgbToHex(rgb) {
    const parts = rgb.match(/\d+/g);
    if (!parts) return '#ffffff';
    return "#" + parts.map(x => {
      const h = parseInt(x).toString(16);
      return h.length === 1 ? '0' + h : h;
    }).join('');
  }
</script>

</body>
</html>
